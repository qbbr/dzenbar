#!/usr/bin/env bash

. .dzenbarrc

MONITOR=${1}
PIPE_LINE=${2}

while true; do
	capacity="$(cat "${BATTERY}/capacity")"
	status=$(sed "s/Discharging/-/;s/Charging/+/;s/Not charging/n/;s/Unknown/u/;s/Full//" "${BATTERY}/status")

	if [[ "$capacity" -le 25 ]] && [[ "$status" == "-" ]]; then
		 status="!${status}"
	fi

	if [[ "${status}" != "" ]]; then
		status="[${status}] "
	fi

	putLineToPipeFile ${MONITOR} ${PIPE_LINE} " $(iconColor 'battery') ${status}${capacity}%"
	sleep ${BATTERY_UPDATE}
done
